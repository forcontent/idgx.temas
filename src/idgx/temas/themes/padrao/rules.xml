<?xml version="1.0" encoding="UTF-8"?>
<rules xmlns="http://namespaces.plone.org/diazo"
		xmlns:css="http://namespaces.plone.org/diazo/css"
		xmlns:xhtml="http://www.w3.org/1999/xhtml"
		xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
		xmlns:xi="http://www.w3.org/2001/XInclude"
    xmlns:esi="http://www.edge-delivery.org/esi/1.0"
    xmlns:str="http://exslt.org/strings">


    <!-- Muda configuração de colunas do Barceloneta, parte 1 -->
    <!-- A coluna principal esta no final do arquivo -->

    <!-- Left column -->
    <rules css:if-content="#portal-column-one">
      <replace css:theme="#column1-container">
        <xsl:variable name="columnone">
          <xsl:if test="//aside[@id='portal-column-two']">coluna-1</xsl:if>
          <xsl:if test="//aside[@id='portal-column-one'] and not(//aside[@id='portal-column-two'])">coluna-1</xsl:if> 
        </xsl:variable>
        <div class="{$columnone} sidebar-offcanvas">
          <aside id="portal-column-one">
            <xsl:copy-of css:select="#portal-column-one > *" />
          </aside>
        </div>
      </replace>
    </rules>
    <!-- Right column -->
    <rules css:if-content="#portal-column-two">
      <replace css:theme="#column2-container">
        <xsl:variable name="columntwo">
          <xsl:if test="//aside[@id='portal-column-one']">coluna-2</xsl:if>
          <xsl:if test="//aside[@id='portal-column-two'] and not(//aside[@id='portal-column-one'])">coluna-2</xsl:if>
        </xsl:variable>
        <div class="{$columntwo} sidebar-offcanvas" role="complementary">
          <aside id="portal-column-two">
            <xsl:copy-of css:select="#portal-column-two > *" />
          </aside>
        </div>
      </replace>
    </rules>


    <!-- Importa regras do Barceloneta -->
    <xi:include href="++theme++barceloneta/rules.xml" />
    <before css:theme-children="head">
      <link rel="stylesheet" href="/++theme++barceloneta/less/barceloneta-compiled.css" />
    </before>

    <rules css:if-content="#visual-portal-wrapper">

      <!-- Copia titulo do portal para exibi-lo
      <replace css:content-children="#idgx-title" css:theme-children="#idgx-title" />
      <drop css:content="#idgx-title" /> -->

      <!-- Move siteactions para o topo -->
      <copy css:content=".actions-site_actions" css:theme="#idgx-actions" />
      <drop css:content="footer .portletActions" />

      <!-- remove busca localizada -->
      <drop css:content=".searchSection" />

      <after css:content=".portlet-static-idgx-icones" css:theme="#mainnavigation" />

      <!-- Adiciona o rodapé -->
      <replace css:content-children="#portal-footer-wrapper" css:theme-children="#portal-footer" />

      <!-- Copia menu para o rodapé -->
      <rules css:if-content=".portlet-static-idgx-navegacao">
        <before css:content="#portal-globalnav" css:theme="#portal-footer" />
        <drop css:content=".portlet-static-idgx-navegacao" />
        <drop attributes="class" css:content="#portal-globalnav" />
        <drop attributes="class" css:content="#portal-globalnav ul" />
        <drop attributes="class" css:content="#portal-globalnav li" />
      </rules>

      <after css:content=".portlet-static-idgx-creditos" css:theme="#portal-footer" method="raw" />
      <drop css:content=".portletWrapper .portlet-static-idgx-creditos" />

      <!-- Muda configuração de colunas do Barceloneta, parte 2 -->
      <!-- Central column -->
      <replace css:theme="#content-container" method="raw">

        <xsl:variable name="central">
          <xsl:if test="//aside[@id='portal-column-one'] and //aside[@id='portal-column-two']">coluna-principal</xsl:if>
          <xsl:if test="//aside[@id='portal-column-two'] and not(//aside[@id='portal-column-one'])">coluna-principal</xsl:if>
          <xsl:if test="//aside[@id='portal-column-one'] and not(//aside[@id='portal-column-two'])">coluna-principal</xsl:if>
          <xsl:if test="not(//aside[@id='portal-column-one']) and not(//aside[@id='portal-column-two'])">coluna-principal</xsl:if>
        </xsl:variable>

        <div class="{$central}">

          <div class="row">
            <div class="col-xs-12 col-sm-12">
              <xsl:apply-templates css:select="#content" />
            </div>
          </div>
          <footer class="row">
            <div class="col-xs-12 col-sm-12">
              <xsl:copy-of css:select="#viewlet-below-content" />
            </div>
          </footer>
        </div>
      </replace>


    </rules>

</rules>
